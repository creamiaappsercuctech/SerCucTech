<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>SerCucTech ‚Äî Indice Link</title>

  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.12);
      --txt:#eaf0ff;
      --muted:rgba(234,240,255,.72);
      --btn:rgba(255,255,255,.10);
      --green:#23c55e;
      --amber:#ffcc66;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 20% -20%, rgba(130,170,255,.20), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(120,255,210,.10), transparent 60%),
        var(--bg);
      color:var(--txt);
      padding:16px;
      padding-bottom:190px;
    }
    .wrap{max-width:980px;margin:0 auto;display:grid;gap:12px}
    .top{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:18px;
      padding:14px;
      box-shadow:var(--shadow);
    }
    h1{margin:0;font-size:20px;font-weight:1000;text-align:center}
    .sub{margin:8px 0 0;color:var(--muted);text-align:center;font-weight:900;line-height:1.35}

    .grid{display:grid;gap:12px}
    @media(min-width:900px){ .grid{grid-template-columns:1fr 1fr;} }

    .card{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:18px;
      padding:14px;
      box-shadow:var(--shadow);
    }
    .titleRow{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .title{font-weight:1000}
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }

    .row{display:grid;gap:10px}
    .item{
      display:grid;
      grid-template-columns:1fr auto auto;
      gap:8px;
      align-items:center;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
    }
    .item a{
      color:var(--txt);
      text-decoration:none;
      font-weight:1000;
      word-break:break-word;
    }
    .desc{
      grid-column:1 / -1;
      color:var(--muted);
      font-size:12px;
      font-weight:800;
      line-height:1.35;
      margin-top:2px;
    }

    .btn{
      border:1px solid var(--line);
      background:var(--btn);
      color:var(--txt);
      border-radius:14px;
      padding:10px 12px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{transform:scale(.99)}
    .btn.green{background:rgba(35,197,94,.18);border-color:rgba(35,197,94,.35)}
    .btn.amber{background:rgba(255,204,102,.18);border-color:rgba(255,204,102,.35)}
    .btnSolid{
      border:none;
      background:var(--green);
      color:#06110a;
      border-radius:16px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
    }
    .btnSolid:active{transform:scale(.99)}
    .btnWide{width:100%}

    input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--txt);
      font-weight:900;
      outline:none;
    }

    .bar{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px;
      background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.55));
      backdrop-filter:blur(10px);
      border-top:1px solid var(--line);
      display:grid;
      gap:10px;
      justify-items:center;
      z-index:999;
    }
    .barInner{
      width:min(980px,100%);
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
    }
    @media(max-width:520px){
      .barInner{grid-template-columns:1fr}
    }

    .warn{
      color:rgba(255,255,255,.86);
      background:rgba(255,204,102,.12);
      border:1px solid rgba(255,204,102,.25);
      padding:10px;
      border-radius:14px;
      font-weight:900;
      font-size:12px;
      line-height:1.35;
    }

    .checklist{
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:12px;
      background:rgba(0,0,0,.18);
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .steps{
      margin:0;
      padding-left:18px;
      color:rgba(255,255,255,.88);
      font-weight:900;
      line-height:1.4;
      font-size:13px;
    }
    .steps li{margin:6px 0}
    .steps b{color:#fff}
    .steps code{
      font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:12px;
      color:rgba(234,240,255,.9);
    }

    .guideTitle{
      font-weight:1000;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .mini{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      line-height:1.35;
    }

    .actions2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width:520px){ .actions2{grid-template-columns:1fr;} }

    .waBtn{
      border:none;
      background:#25D366;
      color:#06210f;
      border-radius:14px;
      padding:10px 12px;
      font-weight:1000;
      cursor:pointer;
      white-space:nowrap;
    }
    .waBtn:active{transform:scale(.99)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <h1>SerCucTech ‚Äî Indice Link</h1>
      <div class="sub">
        Tocca un link per aprirlo. Tocca üîä per sentire la spiegazione (livello 10 anni).
      </div>

      <div class="checklist">
        <div class="guideTitle">
          <div>‚úÖ Checklist veloce (1‚Äì2‚Äì3‚Äì4)</div>
          <span class="pill" id="guideState">pronto</span>
        </div>

        <ol class="steps" id="stepsText">
          <li><b>Crea/Duplica</b> in Admin ‚Üí scarichi <code>ID.json</code>.</li>
          <li>GitHub ‚Üí <b>data</b> ‚Üí incolla in <code>data/ID.json</code> ‚Üí <b>Commit</b>.</li>
          <li>GitHub ‚Üí <b>media</b> ‚Üí carica file (<code>ID-001.jpg</code>, <code>ID-002.jpg</code>...).</li>
          <li>Aggiorna <code>data/vetrine.json</code> ‚Üí Commit ‚Üí condividi: <code>link.html?id=ID</code>.</li>
        </ol>

        <div class="actions2">
          <button class="btnSolid" id="readChecklist">üîä Leggi checklist</button>
          <button class="btn" id="readFullGuide">üéß Guida completa</button>
        </div>

        <div class="actions2">
          <button class="btn" id="pauseGuide">‚è∏Ô∏è Pausa</button>
          <button class="btn" id="resumeGuide">‚ñ∂Ô∏è Riprendi</button>
        </div>

        <div class="warn" id="audioWarn" style="display:none">
          ‚ö†Ô∏è Su Android/Chrome l‚Äôaudio pu√≤ partire solo dopo un tuo tocco.
          Se non senti la voce, tocca di nuovo un pulsante üîä.
        </div>
      </div>
    </div>

    <div class="grid">

      <div class="card">
        <div class="titleRow">
          <div class="title">üîß Pagine principali</div>
          <span class="pill" id="statusPill">carico‚Ä¶</span>
        </div>
        <div class="row" id="mainLinks"></div>
      </div>

      <div class="card">
        <div class="titleRow">
          <div class="title">üîç Apri / Condividi una vetrina per ID</div>
          <span class="pill">WhatsApp pronto</span>
        </div>

        <div class="row">
          <input id="idBox" placeholder="Scrivi ID (es. renzo11)" />
          <button class="btnSolid" id="openLinkBtn">Apri pagina link della vetrina</button>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="item">
            <a id="previewLink" href="link.html?id=renzo11">link.html?id=renzo11</a>
            <button class="btn green" id="copyPreview">Copia</button>
            <button class="btn amber" id="speakPreview">üîä</button>
            <div class="desc" id="shareDesc">
              Usa questi bottoni per condividere.
            </div>
          </div>
        </div>

        <div class="actions2" style="margin-top:10px">
          <button class="btn green" id="copyWhatsAppMsg">üìå Copia messaggio WhatsApp</button>
          <button class="waBtn" id="openWhatsApp">üü¢ Apri WhatsApp (messaggio pronto)</button>
        </div>

        <div class="mini" style="margin-top:10px">
          Nota: ‚ÄúApri WhatsApp‚Äù apre la chat di scelta contatto con testo gi√† pronto.
        </div>
      </div>

    </div>

    <div class="card">
      <div class="titleRow">
        <div class="title">üßæ Elenco vetrine (automatico da data/vetrine.json)</div>
        <span class="pill" id="countPill">0</span>
      </div>
      <div class="row" id="vetrineList"></div>
    </div>
  </div>

  <div class="bar">
    <div class="barInner">
      <button class="btnSolid" id="stopAudio">‚èπÔ∏è Ferma voce</button>
      <button class="btn" id="speakWhatToShare">üîä Cosa condividere su WhatsApp?</button>
      <button class="btn" id="speakIfBroken">üîä Se mi si rompe il telefono?</button>
    </div>
  </div>

<script>
(function(){
"use strict";

const statusPill = document.getElementById("statusPill");
const countPill  = document.getElementById("countPill");
const mainLinks  = document.getElementById("mainLinks");
const vetrineList= document.getElementById("vetrineList");
const audioWarn  = document.getElementById("audioWarn");

const idBox = document.getElementById("idBox");
const openLinkBtn = document.getElementById("openLinkBtn");
const previewLink = document.getElementById("previewLink");
const copyPreview = document.getElementById("copyPreview");
const speakPreview= document.getElementById("speakPreview");
const shareDesc   = document.getElementById("shareDesc");

const copyWhatsAppMsgBtn = document.getElementById("copyWhatsAppMsg");
const openWhatsAppBtn = document.getElementById("openWhatsApp");

const stopAudioBtn= document.getElementById("stopAudio");
const speakWhatToShareBtn = document.getElementById("speakWhatToShare");
const speakIfBrokenBtn = document.getElementById("speakIfBroken");

const guideState = document.getElementById("guideState");
const readChecklistBtn = document.getElementById("readChecklist");
const readFullGuideBtn = document.getElementById("readFullGuide");
const pauseGuideBtn = document.getElementById("pauseGuide");
const resumeGuideBtn = document.getElementById("resumeGuide");

const base = location.origin + location.pathname.replace(/index\.html$/,"");

function canSpeak(){ return "speechSynthesis" in window && "SpeechSynthesisUtterance" in window; }
function stopSpeak(){ try{ speechSynthesis.cancel(); }catch(e){} }
function pauseSpeak(){ try{ speechSynthesis.pause(); }catch(e){} }
function resumeSpeak(){ try{ speechSynthesis.resume(); }catch(e){} }

function speak(text){
  if(!canSpeak()) return alert("Sintesi vocale non disponibile su questo browser.");
  try{
    stopSpeak();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = navigator.language || "it-IT";
    u.rate = 1.03;
    u.onstart = ()=>{ guideState.textContent = "parlo‚Ä¶"; };
    u.onend = ()=>{ guideState.textContent = "finito"; };
    u.onerror = ()=>{ guideState.textContent = "errore"; audioWarn.style.display=""; };
    speechSynthesis.speak(u);
  }catch(e){
    guideState.textContent = "errore";
    audioWarn.style.display = "";
  }
}

stopAudioBtn.addEventListener("click", ()=>{ stopSpeak(); guideState.textContent="pronto"; });
pauseGuideBtn.addEventListener("click", ()=>{ pauseSpeak(); guideState.textContent="in pausa"; });
resumeGuideBtn.addEventListener("click", ()=>{ resumeSpeak(); guideState.textContent="parlo‚Ä¶"; });

function mkItem({label, href, explain}){
  const el = document.createElement("div");
  el.className = "item";
  el.innerHTML = `
    <a href="${href}">${label}</a>
    <button class="btn green copyBtn">Copia</button>
    <button class="btn amber speakBtn">üîä</button>
    <div class="desc"></div>
  `;
  el.querySelector(".desc").textContent = explain.short;
  el.querySelector(".copyBtn").addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText(href.startsWith("http") ? href : (base + href));
      alert("Copiato ‚úÖ");
    }catch(e){
      alert("Copia non riuscita. Tieni premuto sul link e copia manualmente.");
    }
  });
  el.querySelector(".speakBtn").addEventListener("click", ()=> speak(explain.long));
  return el;
}

const explainers = {
  home:{ short:"Questa √® la pagina indice.", long:"Questa pagina √® una mappa. Torna qui quando ti perdi e scegli dove andare." },
  admin:{ short:"Area comandi (solo per te).", long:"Qui crei e duplichi vetrine e fai backup. √à protetto da sblocco + PIN." },
  linkPage:{ short:"Pagina da condividere su WhatsApp.", long:"Condividi sempre link.html?id=ID. √à pi√π semplice per gli utenti." },
  vetrina:{ short:"Pagina con foto e numerini.", long:"Qui l‚Äôutente vede tutte le foto e i numeri sugli oggetti." },
  githubData:{ short:"Qui metti i JSON delle vetrine.", long:"Cartella data su GitHub: ogni vetrina ha il suo file ID.json." },
  githubMedia:{ short:"Qui carichi foto e video.", long:"Cartella media su GitHub: carichi immagini e video, meglio con nomi ID-001 ecc." },
  githubIndex:{ short:"Elenco vetrine.json.", long:"Questo file √® la lista di tutte le vetrine. Serve a farle apparire nell‚Äôelenco." }
};

const checklistSpeak =
`Checklist veloce:
1. Admin: crea o duplica, scarichi ID.json.
2. GitHub: cartella data, incolli in data/ID.json e fai Commit.
3. GitHub: cartella media, carichi le foto e i video con nomi tipo ID-001.
4. Aggiorni data/vetrine.json, fai Commit e condividi su WhatsApp: link.html?id=ID.`;

const fullGuideText =
`Guida completa:
Una vetrina √® una pagina con foto e oggetti. L‚ÄôAdmin √® la stanza dei comandi, solo per te.
Quando crei una vetrina, scarichi un file ID.json.
Poi lo metti su GitHub nella cartella data come data/ID.json e fai Commit.
Poi carichi foto e video nella cartella media.
Poi aggiorni data/vetrine.json per far apparire la nuova vetrina nell‚Äôelenco.
Infine condividi su WhatsApp: link.html?id=ID.`;

readChecklistBtn.addEventListener("click", ()=> speak(checklistSpeak));
readFullGuideBtn.addEventListener("click", ()=> speak(fullGuideText));

function renderMain(){
  mainLinks.innerHTML = "";
  mainLinks.appendChild(mkItem({ label:"üè† Home (questa pagina)", href:"index.html", explain: explainers.home }));
  mainLinks.appendChild(mkItem({ label:"üîí Admin", href:"admin.html", explain: explainers.admin }));
  mainLinks.appendChild(mkItem({ label:"üìÑ Pagina link vetrina (esempio renzo11)", href:"link.html?id=renzo11", explain: explainers.linkPage }));
  mainLinks.appendChild(mkItem({ label:"üñºÔ∏è Vetrina diretta (esempio renzo11)", href:"vetrina.html?id=renzo11", explain: explainers.vetrina }));
  mainLinks.appendChild(mkItem({ label:"üìÅ GitHub cartella data", href:`https://github.com/creamiaappsercuctech/SerCucTech/tree/main/data`, explain: explainers.githubData }));
  mainLinks.appendChild(mkItem({ label:"üñºÔ∏è GitHub cartella media", href:`https://github.com/creamiaappsercuctech/SerCucTech/tree/main/media`, explain: explainers.githubMedia }));
  mainLinks.appendChild(mkItem({ label:"üßæ GitHub file data/vetrine.json", href:`https://github.com/creamiaappsercuctech/SerCucTech/blob/main/data/vetrine.json`, explain: explainers.githubIndex }));
}

function setPreview(id){
  const clean = (id||"renzo11").trim() || "renzo11";
  const href = `link.html?id=${encodeURIComponent(clean)}`;
  previewLink.href = href;
  previewLink.textContent = href;
  previewLink.dataset.id = clean;

  const full = `${base}${href}`;
  shareDesc.textContent = `Link completo: ${full}`;
}

function makeWhatsAppMessage(id){
  const clean = (id||"renzo11").trim() || "renzo11";
  const link = `${base}link.html?id=${encodeURIComponent(clean)}`;
  return `Ciao! üëã\nGuarda questa vetrina:\n${link}\n\n(Se hai domande, rispondi qui su WhatsApp)`;
}

function openWhatsAppWithText(text){
  const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
}

idBox.addEventListener("input", ()=> setPreview(idBox.value));

openLinkBtn.addEventListener("click", ()=>{
  const clean = (idBox.value||"").trim();
  if(!clean) return alert("Scrivi un ID (es. renzo11)");
  location.href = `link.html?id=${encodeURIComponent(clean)}`;
});

copyPreview.addEventListener("click", async ()=>{
  const id = previewLink.dataset.id || "renzo11";
  const full = `${base}link.html?id=${encodeURIComponent(id)}`;
  try{ await navigator.clipboard.writeText(full); alert("Copiato ‚úÖ"); }
  catch(e){ alert("Copia non riuscita."); }
});

speakPreview.addEventListener("click", ()=> speak(explainers.linkPage.long));

copyWhatsAppMsgBtn.addEventListener("click", async ()=>{
  const id = previewLink.dataset.id || "renzo11";
  const msg = makeWhatsAppMessage(id);
  try{
    await navigator.clipboard.writeText(msg);
    alert("Messaggio WhatsApp copiato ‚úÖ");
  }catch(e){
    alert("Copia non riuscita.");
  }
});

openWhatsAppBtn.addEventListener("click", ()=>{
  const id = previewLink.dataset.id || "renzo11";
  const msg = makeWhatsAppMessage(id);
  openWhatsAppWithText(msg);
});

speakWhatToShareBtn.addEventListener("click", ()=> speak("Condividi su WhatsApp la pagina link: link.html?id=ID. √à la pi√π semplice per gli utenti."));
speakIfBrokenBtn.addEventListener("click", ()=> speak("Se ti si rompe il telefono recuperi tutto da GitHub: data per i JSON e media per foto e video."));

/* ----------- Elenco vetrine automatico ----------- */
async function loadIndex(){
  statusPill.textContent = "carico vetrine‚Ä¶";
  try{
    const res = await fetch("data/vetrine.json", {cache:"no-store"});
    if(!res.ok) throw new Error("HTTP " + res.status);
    const j = await res.json();
    const list = Array.isArray(j.vetrine) ? j.vetrine : [];
    countPill.textContent = String(list.length);

    vetrineList.innerHTML = "";
    list.forEach(v=>{
      const id = String(v.id||"").trim();
      if(!id) return;
      const title = String(v.title||id);
      const linkHref = `link.html?id=${encodeURIComponent(id)}`;
      const fullLink = `${base}${linkHref}`;

      const box = document.createElement("div");
      box.className = "item";
      box.innerHTML = `
        <a href="${linkHref}">üë§ ${title} ‚Äî ${linkHref}</a>
        <button class="btn green copyBtn">Copia</button>
        <button class="waBtn waBtnSmall">WhatsApp</button>
        <div class="desc">Copia il link o apri WhatsApp con messaggio pronto.</div>
      `;

      box.querySelector(".copyBtn").addEventListener("click", async ()=>{
        try{ await navigator.clipboard.writeText(fullLink); alert("Copiato ‚úÖ"); }
        catch(e){ alert("Copia non riuscita."); }
      });

      box.querySelector(".waBtnSmall").addEventListener("click", ()=>{
        openWhatsAppWithText(makeWhatsAppMessage(id));
      });

      vetrineList.appendChild(box);
    });

    statusPill.textContent = "pronto";
  }catch(e){
    statusPill.textContent = "errore";
    vetrineList.innerHTML = `
      <div class="warn">
        Non riesco a leggere <b>data/vetrine.json</b>.<br>
        Controlla che esista in repo e che sia pubblico.
      </div>`;
  }
}

renderMain();
setPreview("renzo11");
loadIndex();
})();
</script>

</body>
</html>
