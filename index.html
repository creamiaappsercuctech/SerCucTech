<!doctype html>
<html lang="it">
<head>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b1220">
<link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SerCucTech â€“ Vetrine</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="wrap">

  <div class="card">
    <h2>SerCucTech â€“ Vetrine</h2>
    <div class="small">
      âœ… Locali = salvate nel tuo telefono (admin)<br>
      ğŸŒ Pubbliche = file in GitHub <b>/data/ID.json</b> + registro <b>/data/vetrine.json</b>
    </div>
    <div class="small" style="margin-top:8px">
      <a href="admin.html">ğŸ” Amministrazione</a>
    </div>
  </div>

  <div class="card">
    <h3>Vetrine (locali)</h3>
    <div id="localList" class="small">Caricamento...</div>
  </div>

  <div class="card">
    <h3>Vetrine (pubbliche)</h3>
    <div class="small">Se non si vedono: controlla che esista <b>data/vetrine.json</b>.</div>
    <div id="publicList" class="small">Caricamento...</div>
  </div>

</div>

<script src="app.js"></script>
<script>
(async function(){
  // Locali
  const box = document.getElementById("localList");
  try{
    const ids = await idbListIds();
    if(!ids.length){
      box.innerHTML = "Nessuna vetrina locale.";
    }else{
      const rows = [];
      for(const id of ids){
        const v = await idbGetVetrina(id);
        const t = (v && v.title) ? v.title : id;
        rows.push(`<div style="margin:8px 0">
          <a href="vetrina.html?id=${encodeURIComponent(id)}">ğŸ§© ${escapeHtml(t)}</a>
          <div class="small">vetrina.html?id=${escapeHtml(id)}</div>
        </div>`);
      }
      box.innerHTML = rows.join("");
    }
  }catch(e){
    box.innerHTML = "Errore lettura vetrine locali.";
  }

  // Pubbliche
  const pub = document.getElementById("publicList");
  try{
    const r = await fetch("data/vetrine.json", {cache:"no-store"});
    if(!r.ok) throw new Error("missing");
    const arr = await r.json();
    if(!Array.isArray(arr) || !arr.length){
      pub.innerHTML = "Nessuna vetrina pubblica registrata.";
      return;
    }
    pub.innerHTML = arr.map(v=>{
      const id = encodeURIComponent(v.id);
      const t = escapeHtml(v.title || v.id);
      return `<div style="margin:8px 0">
        <a href="vetrina.html?id=${id}">ğŸŒ ${t}</a>
        <div class="small">vetrina.html?id=${escapeHtml(v.id)}</div>
      </div>`;
    }).join("");
  }catch(e){
    pub.innerHTML = "Manca <b>data/vetrine.json</b> oppure Ã¨ vuoto.";
  }
})();
</script>
</body>
</html>
