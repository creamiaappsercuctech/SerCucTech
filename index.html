<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SerCucTech ‚Ä¢ Indice Link</title>
  <style>
    :root{
      --bg:#070A12;
      --card:#0D1222;
      --card2:#0B1020;
      --text:#EAF0FF;
      --muted:#9AA7C0;
      --line:rgba(255,255,255,.08);
      --accent:#36D399;
      --accent2:#60A5FA;
      --danger:#F87171;
      --warn:#FBBF24;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r:18px;
      --pad:14px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1100px 600px at 30% -10%, rgba(96,165,250,.18), transparent 55%),
                  radial-gradient(900px 500px at 100% 0%, rgba(54,211,153,.16), transparent 55%),
                  var(--bg);
      color:var(--text);
      -webkit-tap-highlight-color: transparent;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px 14px 110px; }

    /* HEADER */
    .top{
      position: sticky;
      top:0;
      z-index:20;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(7,10,18,.90), rgba(7,10,18,.55));
      border-bottom:1px solid var(--line);
    }
    .topInner{ max-width:1100px; margin:0 auto; padding:14px; display:flex; gap:12px; align-items:center; }
    .dot{ width:12px; height:12px; border-radius:999px; background:var(--accent); box-shadow:0 0 0 6px rgba(54,211,153,.14); }
    .titles{ flex:1; min-width:0; }
    .h1{ margin:0; font-size:18px; font-weight:900; letter-spacing:.2px; }
    .sub{ margin:2px 0 0; color:var(--muted); font-size:12px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      background: rgba(255,255,255,.03);
      font-size:12px; color:var(--muted);
      white-space:nowrap;
    }

    /* SEARCH */
    .searchCard{
      margin-top:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--r);
      padding: var(--pad);
      box-shadow: var(--shadow);
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .input{
      flex:1;
      min-width:220px;
      background: rgba(0,0,0,.25);
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px 12px;
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 800;
      cursor:pointer;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ background: rgba(54,211,153,.16); border-color: rgba(54,211,153,.35); }
    .btn.blue{ background: rgba(96,165,250,.16); border-color: rgba(96,165,250,.35); }
    .btn.danger{ background: rgba(248,113,113,.14); border-color: rgba(248,113,113,.35); }
    .btn.small{ padding:8px 10px; border-radius: 12px; font-size:12px; font-weight:900; }

    .hint{ margin:10px 0 0; color:var(--muted); font-size:12px; line-height:1.35; }
    .result{
      margin-top:12px;
      border-top:1px dashed var(--line);
      padding-top:12px;
      display:none;
    }
    .result .big{
      font-weight:900;
      font-size:14px;
    }
    .result .mini{ color:var(--muted); font-size:12px; margin-top:6px; }

    /* LIST */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--r);
      padding: var(--pad);
      box-shadow: var(--shadow);
    }
    .card h2{ margin:0 0 10px; font-size:14px; font-weight:1000; letter-spacing:.2px; }

    .item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px;
      border-radius: 16px;
      border:1px solid transparent;
      background: rgba(0,0,0,.18);
      margin-bottom:10px;
    }
    .item:last-child{ margin-bottom:0; }
    .item.active{
      border-color: rgba(54,211,153,.55);
      box-shadow: 0 0 0 4px rgba(54,211,153,.12);
      background: rgba(54,211,153,.08);
    }
    .num{
      width:46px; height:46px; border-radius: 16px;
      display:flex; align-items:center; justify-content:center;
      font-weight: 1000;
      letter-spacing:.5px;
      background: rgba(96,165,250,.14);
      border:1px solid rgba(96,165,250,.30);
      flex:0 0 auto;
    }
    .meta{ flex:1; min-width:0; }
    .title{ font-weight: 1000; font-size:14px; margin:0; }
    .desc{ margin:3px 0 0; color:var(--muted); font-size:12px; line-height:1.25; }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .linkBtn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      font-weight: 1000;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .linkBtn.primary{ background: rgba(54,211,153,.16); border-color: rgba(54,211,153,.35); }
    .linkBtn.blue{ background: rgba(96,165,250,.16); border-color: rgba(96,165,250,.35); }
    .linkBtn:active{ transform: translateY(1px); }

    /* AUDIO CONTROL DOCK */
    .dock{
      position: fixed;
      left:0; right:0; bottom:0;
      z-index:30;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(to top, rgba(7,10,18,.92), rgba(7,10,18,.60));
      border-top:1px solid var(--line);
      backdrop-filter: blur(10px);
    }
    .dockInner{
      max-width:1100px; margin:0 auto;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .dockLabel{
      color:var(--muted);
      font-size:12px;
      font-weight:900;
      display:flex; align-items:center; gap:8px;
    }
    .speed{
      display:flex; gap:8px; align-items:center; flex:1;
      min-width: 220px;
    }
    input[type="range"]{ width:100%; }

    /* POPUP */
    .popup{
      position: fixed;
      left: 12px;
      right: 12px;
      top: 72px;
      z-index: 40;
      display:none;
      max-width: 1100px;
      margin: 0 auto;
    }
    .popupCard{
      background: rgba(13,18,34,.92);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 12px 12px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .popupTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:6px;
    }
    .popupTitle{ font-weight:1000; font-size:13px; }
    .popupText{ color:var(--text); font-size:13px; line-height:1.35; white-space:pre-wrap; }
    .x{ border:none; background:transparent; color:var(--muted); font-weight:1000; font-size:16px; cursor:pointer; }

    .tiny{ font-size:11px; color:var(--muted); margin-top:6px; }
  </style>
</head>

<body>
  <header class="top">
    <div class="topInner">
      <div class="dot" aria-hidden="true"></div>
      <div class="titles">
        <h1 class="h1">SerCucTech ‚Ä¢ Indice Link (con guida vocale)</h1>
        <p class="sub">Tutti i tuoi strumenti in un posto: tocchi, ascolti, e apri.</p>
      </div>
      <div class="pill" id="basePill">Base: ‚Ä¶</div>
    </div>
  </header>

  <div class="popup" id="popup">
    <div class="popupCard">
      <div class="popupTop">
        <div class="popupTitle" id="popupTitle">Guida</div>
        <button class="x" id="popupClose" aria-label="Chiudi">‚úï</button>
      </div>
      <div class="popupText" id="popupText"></div>
      <div class="tiny" id="popupTiny"></div>
    </div>
  </div>

  <div class="wrap">
    <section class="searchCard">
      <div class="row">
        <input id="q" class="input"
          placeholder='Scrivi cosa devi fare‚Ä¶ es: "devo numerare gli oggetti della foto id renzo11"'
          autocomplete="off" />
        <button class="btn primary" id="searchBtn">Cerca</button>
        <button class="btn" id="clearBtn">Pulisci</button>
      </div>
      <div class="hint">
        Suggerimenti rapidi: <b>numerare oggetti</b>, <b>vetrina renzo11</b>, <b>admin</b>, <b>rinominare foto</b>, <b>guida</b>, <b>checklist</b>, <b>pubblica</b>.
      </div>
      <div class="result" id="resultBox">
        <div class="big" id="resultBig"></div>
        <div class="mini" id="resultMini"></div>
        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn blue" id="resultSpeakBtn">üéß Spiega</button>
          <button class="btn primary" id="resultOpenBtn">üîó Apri link consigliato</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <h2>üìå Link principali</h2>
        <div id="list"></div>
      </section>

      <section class="card">
        <h2>üõçÔ∏è Vetrine pubbliche (da data/vetrine.json)</h2>
        <div class="hint" style="margin:0 0 10px;">
          Qui compaiono automaticamente le vetrine che aggiungi nel file <b>data/vetrine.json</b>.
        </div>
        <div id="vetrineList"></div>
      </section>
    </div>
  </div>

  <div class="dock">
    <div class="dockInner">
      <div class="dockLabel">Audio:</div>
      <button class="btn small" id="muteBtn">Mute</button>
      <button class="btn small" id="pauseBtn">Pause</button>
      <button class="btn small" id="resumeBtn">Play</button>
      <button class="btn small" id="repeatBtn">Repeat</button>

      <div class="speed">
        <div class="dockLabel" style="min-width:110px;">Velocit√†</div>
        <input type="range" id="rate" min="0.7" max="1.3" step="0.05" value="1.00" />
        <div class="pill" id="rateVal">1.00x</div>
      </div>
    </div>
  </div>

  <script>
    // ===================== BASE URL =====================
    const BASE = location.origin + location.pathname.replace(/\\/[^\\/]*$/, '/'); // folder corrente
    document.getElementById("basePill").textContent = "Base: " + BASE;

    // ===================== AUDIO ENGINE =====================
    const synth = window.speechSynthesis;
    let lastUtter = null;
    let lastText = "";
    let muted = false;
    let speechRate = 1.0;

    const popup = document.getElementById("popup");
    const popupTitle = document.getElementById("popupTitle");
    const popupText = document.getElementById("popupText");
    const popupTiny = document.getElementById("popupTiny");
    document.getElementById("popupClose").onclick = () => hidePopup();

    function showPopup(title, text, tiny=""){
      popupTitle.textContent = title;
      popupText.textContent = text;
      popupTiny.textContent = tiny || "";
      popup.style.display = "block";
    }
    function hidePopup(){ popup.style.display = "none"; }

    function speak(text, title="Guida", tiny=""){
      lastText = text || "";
      // se muted, mostra solo popup
      showPopup(title, text, tiny);

      if(muted) return;

      try{
        synth.cancel();
      }catch(e){}

      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "it-IT";
      utter.rate = speechRate;
      utter.onend = () => {
        // popup sparisce a fine audio
        hidePopup();
      };
      utter.onerror = () => {
        // se errore, lascia popup visibile 6 secondi e poi chiudi
        setTimeout(hidePopup, 6000);
      };
      lastUtter = utter;
      synth.speak(utter);
    }

    // Controls
    const rateEl = document.getElementById("rate");
    const rateVal = document.getElementById("rateVal");
    rateEl.addEventListener("input", ()=>{
      speechRate = parseFloat(rateEl.value);
      rateVal.textContent = speechRate.toFixed(2) + "x";
    });

    document.getElementById("muteBtn").onclick = ()=>{
      muted = !muted;
      document.getElementById("muteBtn").textContent = muted ? "Unmute" : "Mute";
      if(muted) try{ synth.cancel(); }catch(e){}
    };
    document.getElementById("pauseBtn").onclick = ()=>{ try{ synth.pause(); }catch(e){} };
    document.getElementById("resumeBtn").onclick = ()=>{ try{ synth.resume(); }catch(e){} };
    document.getElementById("repeatBtn").onclick = ()=>{
      if(lastText) speak(lastText, popupTitle.textContent || "Guida");
    };

    // ===================== LINK DATA =====================
    // (Puoi aggiungere/togliere link qui quando vuoi)
    const links = [
      {
        key: "admin",
        title: "Admin (gestione vetrine)",
        desc: "Crea/modifica vetrine, testi, media e impostazioni.",
        url: "admin.html",
        keywords: ["admin","crea vetrina","modifica vetrina","gestione","privato","pin"],
        guide: [
          "Questo √® l'ADMIN. Qui crei e modifichi le vetrine.",
          "Se devi aggiungere foto o cambiare il testo, entra qui.",
          "Poi salva, e condividi il link pubblico della vetrina."
        ].join("\\n")
      },
      {
        key: "vetrina",
        title: "Vetrina pubblica (apertura per utenti)",
        desc: "Pagina che mostra foto scorrevoli e pulsanti WhatsApp.",
        url: "vetrina.html?id=renzo11",
        keywords: ["vetrina","pubblico","renzo11","foto scorrevoli","whatsapp","condividere"],
        guide: [
          "Questa √® una VETRINA pubblica.",
          "Gli utenti vedono le foto scorrevoli e i tasti di contatto.",
          "Se vuoi aprire una vetrina specifica, usa: vetrina punto html, punto interrogativo, id uguale, nome vetrina."
        ].join("\\n")
      },
      {
        key: "pubblica",
        title: "Pubblica (strumento pubblicazione/link)",
        desc: "Pagina utile per link e condivisione (se la usi).",
        url: "pubblica.html",
        keywords: ["pubblica","condividi","link","whatsapp","pubblicazione"],
        guide: [
          "Qui puoi trovare strumenti di pubblicazione e condivisione.",
          "Se non ti serve, puoi ignorarla."
        ].join("\\n")
      },
      {
        key: "rename",
        title: "Rinomina file in sequenza",
        desc: "Strumento per rinominare immagini e file in modo progressivo.",
        url: "rename.html",
        keywords: ["rinominare","sequenza","rename","file","immagini","foto"],
        guide: [
          "Qui rinomini tanti file in sequenza: 001, 002, 003‚Ä¶",
          "Utile prima di caricare le foto nella cartella media.",
          "Alla fine scarichi/usi i nomi nuovi."
        ].join("\\n")
      },
      {
        key: "contatore",
        title: "Contatore oggetti su foto (manuale)",
        desc: "Metti numerini manuali sugli oggetti in una foto e regoli la grandezza.",
        url: "tools/contatore.html",
        keywords: ["numerare","oggetti","foto","pins","numerini","contatore","manuale"],
        guide: [
          "Questo serve per NUMERARE manualmente gli oggetti nella foto.",
          "Tocchi l'immagine e piazzi 1, 2, 3‚Ä¶ dove vuoi.",
          "Poi esporti il JSON dei punti (pins) e lo inserisci nella vetrina."
        ].join("\\n")
      },
      {
        key: "guida",
        title: "Guida (pagina istruzioni)",
        desc: "Guida generale del progetto e delle funzioni.",
        url: "guida.html",
        keywords: ["guida","istruzioni","aiuto","come fare","tutorial"],
        guide: [
          "Qui trovi una guida testuale per capire le funzioni.",
          "Se non ricordi dove si fa una cosa, apri questa pagina."
        ].join("\\n")
      },
      {
        key: "checklist",
        title: "Checklist",
        desc: "Checklist operative (sezione dedicata).",
        url: "checklist.html",
        keywords: ["checklist","lista","controllo","attivit√†"],
        guide: [
          "Questa √® una checklist: una lista di cose da fare.",
          "Serve per non dimenticare passaggi importanti."
        ].join("\\n")
      }
    ];

    // ===================== RENDER LIST =====================
    function pad2(n){ return String(n).padStart(2,"0"); }

    const listEl = document.getElementById("list");
    function renderLinks(){
      listEl.innerHTML = "";
      links.forEach((it, idx)=>{
        const n = idx+1;
        const row = document.createElement("div");
        row.className = "item";
        row.dataset.num = String(n);
        row.dataset.key = it.key;

        row.innerHTML = `
          <div class="num">${pad2(n)}</div>
          <div class="meta">
            <div class="title">${it.title}</div>
            <div class="desc">${it.desc}</div>
          </div>
          <div class="actions">
            <button class="linkBtn blue" data-act="speak">üéß Audio</button>
            <button class="linkBtn primary" data-act="open">üîó Apri</button>
          </div>
        `;

        row.querySelector('[data-act="speak"]').onclick = ()=>{
          focusItem(row);
          speak(it.guide, `Link ${pad2(n)} ‚Ä¢ ${it.title}`, `Apre: ${BASE}${it.url}`);
        };

        row.querySelector('[data-act="open"]').onclick = ()=>{
          focusItem(row);
          // parla e popup, poi apri
          speak(it.guide, `Link ${pad2(n)} ‚Ä¢ ${it.title}`, `Sto aprendo: ${BASE}${it.url}`);
          setTimeout(()=> window.open(it.url, "_blank", "noopener,noreferrer"), 250);
        };

        listEl.appendChild(row);
      });
    }

    function clearActive(){
      document.querySelectorAll(".item.active").forEach(el=>el.classList.remove("active"));
    }
    function focusItem(row){
      clearActive();
      row.classList.add("active");
      row.scrollIntoView({behavior:"smooth", block:"center"});
    }

    renderLinks();

    // ===================== LOAD VETRINE INDEX (data/vetrine.json) =====================
    const vetrineListEl = document.getElementById("vetrineList");

    async function loadVetrine(){
      vetrineListEl.innerHTML = `<div class="hint">Caricamento vetrine‚Ä¶</div>`;
      try{
        const r = await fetch("data/vetrine.json", {cache:"no-store"});
        if(!r.ok) throw new Error("HTTP " + r.status);
        const data = await r.json();

        const arr = (data && data.vetrine) ? data.vetrine : [];
        if(!arr.length){
          vetrineListEl.innerHTML = `<div class="hint">Nessuna vetrina trovata in data/vetrine.json</div>`;
          return;
        }

        vetrineListEl.innerHTML = "";
        arr.forEach((v, i)=>{
          const title = v.title || v.id;
          const id = v.id;
          const url = `vetrina.html?id=${encodeURIComponent(id)}`;

          const card = document.createElement("div");
          card.className = "item";
          card.innerHTML = `
            <div class="num">V${pad2(i+1)}</div>
            <div class="meta">
              <div class="title">${title}</div>
              <div class="desc">Apri vetrina pubblica: <span style="color:var(--muted)">${id}</span></div>
            </div>
            <div class="actions">
              <button class="linkBtn blue">üéß Audio</button>
              <button class="linkBtn primary">üîó Apri</button>
            </div>
          `;
          const guide = [
            `Questa √® la vetrina "${title}".`,
            `Si apre con: vetrina punto html, punto interrogativo, id uguale ${id}.`,
            `Gli utenti vedono foto scorrevoli e i pulsanti WhatsApp.`
          ].join("\\n");

          card.querySelectorAll(".linkBtn")[0].onclick = ()=>{
            clearActive();
            card.classList.add("active");
            speak(guide, `Vetrina ‚Ä¢ ${title}`, `Apre: ${BASE}${url}`);
          };
          card.querySelectorAll(".linkBtn")[1].onclick = ()=>{
            clearActive();
            card.classList.add("active");
            speak(guide, `Vetrina ‚Ä¢ ${title}`, `Sto aprendo: ${BASE}${url}`);
            setTimeout(()=> window.open(url, "_blank", "noopener,noreferrer"), 250);
          };

          vetrineListEl.appendChild(card);
        });

      }catch(e){
        vetrineListEl.innerHTML = `<div class="hint">Errore nel leggere <b>data/vetrine.json</b>. Controlla che esista e che sia JSON valido.</div>`;
      }
    }
    loadVetrine();

    // ===================== SEARCH / MATCH =====================
    const qEl = document.getElementById("q");
    const resultBox = document.getElementById("resultBox");
    const resultBig = document.getElementById("resultBig");
    const resultMini = document.getElementById("resultMini");
    const resultSpeakBtn = document.getElementById("resultSpeakBtn");
    const resultOpenBtn = document.getElementById("resultOpenBtn");

    let bestMatch = null;

    function normalize(s){
      return (s||"").toLowerCase()
        .replace(/[√†√°√¢√§]/g,"a").replace(/[√®√©√™√´]/g,"e").replace(/[√¨√≠√Æ√Ø]/g,"i")
        .replace(/[√≤√≥√¥√∂]/g,"o").replace(/[√π√∫√ª√º]/g,"u")
        .replace(/[^a-z0-9+ ]/g," ")
        .replace(/\s+/g," ")
        .trim();
    }

    function scoreItem(query, item){
      const q = normalize(query);
      const hay = normalize([item.title, item.desc, (item.keywords||[]).join(" ")].join(" "));
      if(!q) return 0;

      let score = 0;
      const words = q.split(" ");
      for(const w of words){
        if(!w) continue;
        if(hay.includes(w)) score += 2;
      }

      // extra: se contiene un id tipo renzo11 e link √® vetrina
      const idMatch = q.match(/\b([a-z]{3,}\d{1,})\b/);
      if(idMatch){
        const id = idMatch[1];
        if(item.url && item.url.includes("vetrina.html") && q.includes(id)) score += 6;
        if((item.keywords||[]).includes(id)) score += 6;
      }

      // bonus se query contiene "numerare" e item √® contatore
      if(q.includes("numer") && item.key === "contatore") score += 6;

      return score;
    }

    function doSearch(){
      const query = qEl.value.trim();
      bestMatch = null;

      // cerca nei link principali
      let best = {score:0, type:"main", item:null, num:null};
      links.forEach((it, idx)=>{
        const s = scoreItem(query, it);
        if(s > best.score){
          best = {score:s, type:"main", item:it, num: idx+1};
        }
      });

      // se query contiene id, prova a suggerire direttamente vetrina pubblica
      const idMatch = normalize(query).match(/\b([a-z]{3,}\d{1,})\b/);
      if(idMatch){
        const id = idMatch[1];
        // suggerimento forte: aprire vetrina con quell'id
        if(best.score < 6){
          best = {
            score: 6,
            type: "dynamicVetrina",
            item: {
              title: `Vetrina pubblica: ${id}`,
              desc: `Apri la vetrina con id ${id}`,
              url: `vetrina.html?id=${encodeURIComponent(id)}`,
              guide: [
                `Devi lavorare sulla vetrina con id ${id}.`,
                `Aprila con questo link: vetrina punto html, punto interrogativo, id uguale ${id}.`,
                `Se vuoi numerare gli oggetti della foto, usa anche il contatore oggetti e poi incolla i pins nella vetrina.`
              ].join("\\n")
            },
            num: null
          };
        }
      }

      if(best.score <= 0){
        resultBox.style.display = "block";
        resultBig.textContent = "Non ho trovato un link sicuro. Prova con parole pi√π semplici.";
        resultMini.textContent = "Esempio: ‚Äúnumerare oggetti foto‚Äù, ‚Äúadmin‚Äù, ‚Äúrinominare foto‚Äù, ‚Äúvetrina renzo11‚Äù.";
        resultSpeakBtn.onclick = ()=> speak(
          "Non ho trovato un link preciso. Scrivi una frase pi√π corta, per esempio: numerare oggetti foto, oppure admin, oppure rinominare foto.",
          "Ricerca"
        );
        resultOpenBtn.onclick = ()=>{};
        return;
      }

      bestMatch = best;

      resultBox.style.display = "block";
      if(best.type === "main"){
        resultBig.textContent = `Usa il link n. ${pad2(best.num)}: ${best.item.title}`;
        resultMini.textContent = `Perch√©: ${best.item.desc}`;
        resultSpeakBtn.onclick = ()=>{
          const row = document.querySelector(`.item[data-num="${best.num}"]`);
          if(row) focusItem(row);
          speak(best.item.guide, `Consiglio: link ${pad2(best.num)}`, `Apre: ${BASE}${best.item.url}`);
        };
        resultOpenBtn.onclick = ()=>{
          const row = document.querySelector(`.item[data-num="${best.num}"]`);
          if(row) focusItem(row);
          speak(best.item.guide, `Consiglio: link ${pad2(best.num)}`, `Sto aprendo: ${BASE}${best.item.url}`);
          setTimeout(()=> window.open(best.item.url, "_blank", "noopener,noreferrer"), 250);
        };
      } else {
        resultBig.textContent = `Usa: ${best.item.title}`;
        resultMini.textContent = `Link diretto: ${best.item.url}`;
        resultSpeakBtn.onclick = ()=> speak(best.item.guide, "Consiglio ricerca", `Apre: ${BASE}${best.item.url}`);
        resultOpenBtn.onclick = ()=>{
          speak(best.item.guide, "Consiglio ricerca", `Sto aprendo: ${BASE}${best.item.url}`);
          setTimeout(()=> window.open(best.item.url, "_blank", "noopener,noreferrer"), 250);
        };
      }
    }

    document.getElementById("searchBtn").onclick = doSearch;
    qEl.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doSearch(); });

    document.getElementById("clearBtn").onclick = ()=>{
      qEl.value = "";
      resultBox.style.display = "none";
      clearActive();
      hidePopup();
      try{ synth.cancel(); }catch(e){}
    };

    // Piccola guida iniziale (solo prima volta per dispositivo)
    try{
      const k="sercuctech_links_intro_v1";
      if(!localStorage.getItem(k)){
        localStorage.setItem(k,"1");
        setTimeout(()=>{
          speak(
            "Questa √® la tua pagina indice. Ogni riga ha un numero e due pulsanti: Audio e Apri. " +
            "Se scrivi cosa devi fare nella ricerca, io ti consiglio il link giusto.",
            "Benvenuto nell'indice"
          );
        }, 600);
      }
    }catch(e){}
  </script>
</body>
</html>.
