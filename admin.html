<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SerCucTech | Admin</title>

<style>
:root{
  --bg:#0b1220; --fg:#e5e7eb; --muted:#94a3b8;
  --card:#0f172a; --border:#1f2a44; --btn:#2563eb;
  --danger:#ef4444; --ok:#22c55e;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
header{position:sticky;top:0;z-index:5;background:rgba(0,0,0,.25);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
.wrap{max-width:1100px;margin:0 auto;padding:14px 16px}
h1{margin:0;font-size:20px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
.btn{border:0;cursor:pointer;border-radius:10px;padding:10px 12px;background:var(--btn);color:white;font-weight:700}
.btn.secondary{background:transparent;border:1px solid var(--border);color:var(--fg)}
.btn.danger{background:var(--danger)}
.btn.ok{background:var(--ok);color:#06210f}
main{padding:16px}
.grid{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:980px){.grid{grid-template-columns:420px 1fr}}
.card{background:rgba(0,0,0,.18);border:1px solid var(--border);border-radius:16px;padding:14px}
label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
input,textarea,select{
  width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);
  background:rgba(255,255,255,.03);color:var(--fg);outline:none
}
textarea{min-height:80px}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.small{font-size:12px;color:var(--muted);margin-top:8px}
.list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.item{border:1px solid var(--border);border-radius:14px;padding:12px;background:rgba(255,255,255,.03)}
.links{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
a{color:#93c5fd;text-decoration:none}
a:hover{text-decoration:underline}
.thumbs{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:10px}
.thumb{border:1px solid var(--border);border-radius:12px;overflow:hidden;background:rgba(255,255,255,.05)}
.thumbMedia{width:100%;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;overflow:hidden}
.thumb img,.thumb video{width:100%;height:100%;object-fit:cover}
.viewer{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;z-index:9999}
.viewer.active{display:flex}
.viewer img,.viewer video{max-width:96%;max-height:96%;border-radius:14px}
.toast{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
  background:rgba(15,23,42,.95);border:1px solid var(--border);
  padding:10px 12px;border-radius:999px;display:none}
.toast.show{display:block}

/* ===== LOCK SCREEN INVISIBILE ===== */
#lockScreen{
  position:fixed;inset:0;z-index:10000;
  background:#0b1220;color:#fff;
  display:flex;align-items:center;justify-content:center;
}
#secretSentence{max-width:420px;line-height:1.7;opacity:.9}
#secretSentence span{cursor:pointer}
#pinError{display:none;color:#ff6b6b;margin-top:14px}
</style>
</head>

<body>

<!-- ===== ACCESSO INVISIBILE ===== -->
<div id="lockScreen">
  <div>
    <p id="secretSentence">
      Lâ€™accesso alla gestione avviene solo quando la
      <span data-k="a">luce</span>
      incontra la
      <span data-k="b">porta</span>
      giusta nel momento corretto.
    </p>
    <p id="pinError">Accesso negato</p>
  </div>
</div>

<header>
  <div class="wrap">
    <h1>Admin Vetrine â€” SerCucTech</h1>
    <div class="row">
      <button class="btn secondary" id="btnExportIndex">â¬‡ Esporta data/vetrine.json</button>
    </div>
  </div>
</header>

<main class="wrap grid">
  <section class="card">
    <label>ID vetrina</label>
    <input id="f_id" placeholder="scalvini10"/>

    <label>Titolo</label>
    <input id="f_title"/>

    <label>Descrizione</label>
    <textarea id="f_desc"></textarea>

    <div class="two">
      <div><label>Dimensione titolo</label><input id="f_titleSize" type="number" value="32"/></div>
      <div>
        <label>Font</label>
        <select id="f_fontFamily">
          <option value="system-ui">System</option>
          <option>Arial</option><option>Georgia</option><option>Verdana</option>
        </select>
      </div>
    </div>

    <div class="three">
      <div><label>Colore titolo</label><input id="f_titleColor" type="color" value="#ffffff"/></div>
      <div><label>Colore sfondo</label><input id="f_bgColor" type="color" value="#0b1220"/></div>
      <div><label>Immagine sfondo</label><input id="f_bgImage" type="file" accept="image/*"/></div>
    </div>

    <label>Voce (lingua)</label>
    <input id="f_voiceLang" value="it-IT"/>

    <label>Testo voce</label>
    <textarea id="f_voiceText"></textarea>

    <label>Upload immagini / video (multiplo)</label>
    <input id="f_files" type="file" accept="image/*,video/*" multiple/>

    <div class="row">
      <button class="btn ok" id="btnSave">ðŸ’¾ Salva (locale)</button>
      <button class="btn secondary" id="btnExportOne">â¬‡ Esporta ID.json</button>
      <button class="btn danger" id="btnDelete">ðŸ—‘ Cancella</button>
    </div>
  </section>

  <section class="card">
    <div id="list" class="list"></div>
    <div id="thumbs" class="thumbs"></div>
  </section>
</main>

<div class="viewer" id="viewer"></div>
<div class="toast" id="toast"></div>

<script>
/* ===== ACCESSO INVISIBILE ===== */
const SECRET_SEQUENCE=["a","b"]; // luce â†’ porta
let seq=[];
const unlock=()=>{document.getElementById("lockScreen").style.display="none";localStorage.setItem("adminUnlocked","1");}
const err=()=>{const e=document.getElementById("pinError");e.style.display="block";setTimeout(()=>e.style.display="none",1200);}
document.getElementById("secretSentence").addEventListener("click",e=>{
  const k=e.target.getAttribute("data-k"); if(!k) return;
  seq.push(k);
  for(let i=0;i<seq.length;i++){ if(seq[i]!==SECRET_SEQUENCE[i]){seq=[];err();return;} }
  if(seq.length===SECRET_SEQUENCE.length){unlock();seq=[];}
});
if(localStorage.getItem("adminUnlocked")==="1") unlock();

/* ===== LOGICA ADMIN (salvataggio + export) ===== */
const LS="sct_"; const idxKey="sct_index";
const $=id=>document.getElementById(id);
const show=m=>{const t=$("toast");t.textContent=m;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2000);}
const clean=x=>(x||"").trim().replace(/\s+/g,"").replace(/[^a-z0-9_-]/gi,"");
const getIndex=()=>JSON.parse(localStorage.getItem(idxKey)||"[]");
const setIndex=a=>localStorage.setItem(idxKey,JSON.stringify(a));
const load=id=>JSON.parse(localStorage.getItem(LS+id)||"null");
const save=o=>{localStorage.setItem(LS+o.id,JSON.stringify(o));const i=getIndex().filter(x=>x.id!==o.id);i.unshift({id:o.id,title:o.title});setIndex(i);}
const del=id=>{localStorage.removeItem(LS+id);setIndex(getIndex().filter(x=>x.id!==id));}

const toDataURL=f=>new Promise(r=>{const fr=new FileReader();fr.onload=()=>r(fr.result);fr.readAsDataURL(f);});

$("btnSave").onclick=async()=>{
  const id=clean($("f_id").value); if(!id) return alert("ID mancante");
  $("f_id").value=id;
  const prev=load(id)||{};
  const files=[...(prev.files||[])];
  if($("f_files").files.length){
    for(const f of $("f_files").files){
      files.push({name:f.name,kind:f.type.startsWith("video")?"video":"image",mime:f.type,url:await toDataURL(f)});
    }
  }
  const bg=$("f_bgImage").files[0]?await toDataURL($("f_bgImage").files[0]):(prev.bgImage||"");
  const obj={
    id,title:$("f_title").value||id,desc:$("f_desc").value||"",
    titleSize:+$("f_titleSize").value||32,titleColor:$("f_titleColor").value,
    bgColor:$("f_bgColor").value,bgImage:bg,fontFamily:$("f_fontFamily").value,
    voiceLang:$("f_voiceLang").value,voiceText:$("f_voiceText").value,files
  };
  save(obj); show("Salvato");
};

$("btnExportOne").onclick=()=>{
  const id=clean($("f_id").value); const o=load(id); if(!o) return alert("Salva prima");
  const b=new Blob([JSON.stringify(o,null,2)],{type:"application/json"});
  const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download=id+".json";a.click();
};

$("btnExportIndex").onclick=()=>{
  const out=getIndex().map(x=>({id:x.id,title:x.title}));
  const b=new Blob([JSON.stringify(out,null,2)],{type:"application/json"});
  const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="vetrine.json";a.click();
};

$("btnDelete").onclick=()=>{
  const id=clean($("f_id").value); if(!id) return;
  if(confirm("Cancellare "+id+"?")){del(id); show("Cancellata");}
};
</script>
</body>
</html>
