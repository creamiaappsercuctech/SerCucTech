<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Admin SerCucTech</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui;background:#0f172a;color:white;padding:20px}
.card{background:#020617;padding:16px;border-radius:12px;margin-bottom:16px}
input,textarea,button{width:100%;padding:10px;margin:6px 0}
button{background:#2563eb;border:none;border-radius:8px;color:white}
.hidden{display:none}
.small{font-size:13px;opacity:.85}
.file{display:flex;justify-content:space-between;align-items:center}
.file button{width:auto;background:#dc2626}
.link{font-size:13px;word-break:break-all}
</style>
</head>
<body>

<h2 id="t_admin">Amministrazione SerCucTech</h2>

<div class="card" id="loginBox">
  <input id="pinInput" type="password" placeholder="PIN">
  <button id="loginBtn">Entra</button>
</div>

<div id="panel" class="hidden">

<div class="card">
<h3 id="t_new">Nuova Vetrina</h3>
<input id="vid" placeholder="ID vetrina (es: negozio1)">
<input id="title" placeholder="Titolo">
<textarea id="desc" placeholder="Descrizione"></textarea>
<input type="number" id="titleSize" value="32">
<input type="color" id="titleColor">
<input type="color" id="bgColor">
<input type="file" id="bgImage" accept="image/*">
</div>

<div class="card">
<h3 id="t_files">File</h3>
<input type="file" id="files" multiple accept="image/*,video/*">
<button id="uploadBtn">Carica file</button>
<div id="fileList"></div>
</div>

<button id="saveBtn">Salva Vetrina</button>

<div class="card">
<h3>Vetrine create</h3>
<div id="vetrineList"></div>
</div>

<div class="card">
<h3>Cambio PIN</h3>
<input id="newPin" placeholder="Nuovo PIN">
<button onclick="changePin()">Cambia PIN</button>
</div>

</div>

<script>
/* ===== MULTILINGUA ===== */
const lang = (navigator.language || 'en').slice(0,2);
const T = {
 it:{admin:"Amministrazione",new:"Nuova Vetrina",files:"File"},
 uk:{admin:"Адміністрування",new:"Нова вітрина",files:"Файли"},
 en:{admin:"Administration",new:"New Vetrina",files:"Files"},
 ja:{admin:"管理",new:"新しいショーケース",files:"ファイル"}
};
const L=T[lang]||T.en;
t_admin.textContent=L.admin;
t_new.textContent=L.new;
t_files.textContent=L.files;

/* ===== PIN ===== */
if(!localStorage.getItem("admin_pin")){
  localStorage.setItem("admin_pin","1234");
}
loginBtn.onclick=()=>{
  if(pinInput.value===localStorage.getItem("admin_pin")){
    loginBox.classList.add("hidden");
    panel.classList.remove("hidden");
    loadVetrine();
  } else alert("PIN errato");
};

function changePin(){
  if(newPin.value){
    localStorage.setItem("admin_pin",newPin.value);
    alert("PIN aggiornato");
  }
}

/* ===== FILE ===== */
let uploaded=[];
uploadBtn.onclick=()=>{
  [...files.files].forEach(f=>{
    const r=new FileReader();
    r.onload=()=>{
      uploaded.push({name:f.name,type:f.type,data:r.result});
      renderFiles();
    };
    r.readAsDataURL(f);
  });
};
function renderFiles(){
  fileList.innerHTML="";
  uploaded.forEach((f,i)=>{
    fileList.innerHTML+=`
    <div class="file">
      <span>${f.name}</span>
      <button onclick="delFile(${i})">X</button>
    </div>`;
  });
}
function delFile(i){uploaded.splice(i,1);renderFiles();}

/* ===== SALVA VETRINA ===== */
function save(){
  if(!vid.value){alert("ID obbligatorio");return;}
  const all=JSON.parse(localStorage.getItem("vetrine")||"{}");
  all[vid.value]={
    title:title.value,desc:desc.value,
    titleSize:titleSize.value,
    titleColor:titleColor.value,
    bgColor:bgColor.value,
    bgImage:bgImage.files[0]?URL.createObjectURL(bgImage.files[0]):null,
    files:uploaded
  };
  localStorage.setItem("vetrine",JSON.stringify(all));
  alert("Vetrina salvata");
  loadVetrine();
}
saveBtn.onclick=save;

/* ===== LISTA VETRINE + LINK ===== */
function loadVetrine(){
  const all=JSON.parse(localStorage.getItem("vetrine")||"{}");
  vetrineList.innerHTML="";
  Object.keys(all).forEach(id=>{
    const link=`index.html?vetrina=${id}`;
    vetrineList.innerHTML+=`
      <div class="card small">
        <b>${id}</b><br>
        <a class="link" href="${link}" target="_blank">${link}</a>
        <button onclick="navigator.clipboard.writeText('${location.origin+location.pathname.replace('admin.html','')+link}')">Copia link</button>
      </div>`;
  });
}
</script>

</body>
</html>
