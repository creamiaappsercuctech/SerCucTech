<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin SerCucTech</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="wrap">

<div class="card" id="login">
  <h3>Accesso Admin</h3>
  <input id="pin" type="password" placeholder="PIN">
  <button onclick="login()">Entra</button>
</div>

<div id="panel" class="hidden">

<div class="card">
  <h3>Nuova / Modifica Vetrina</h3>
  <input id="vid" placeholder="ID vetrina (es: negozio1)">
  <input id="title" placeholder="Titolo">
  <textarea id="desc" placeholder="Descrizione"></textarea>

  <input type="number" id="titleSize" value="32">
  <label>Colore titolo</label>
  <input type="color" id="titleColor" value="#ffffff">
  <label>Colore sfondo</label>
  <input type="color" id="bgColor" value="#0b1020">

  <input type="file" id="files" multiple accept="image/*,video/*">
  <button onclick="upload()">Carica file</button>
  <div id="fileList"></div>

  <button onclick="save()">Salva vetrina</button>
</div>

<div class="card">
  <h3>Vetrine create</h3>
  <div id="list"></div>
</div>

</div>
</div>

<script src="app.js"></script>
<script>
initPin();

let uploaded = [];

function login() {
  if (pin.value === getPin()) {
    login.style.display = "none";
    panel.classList.remove("hidden");
    renderList();
  } else alert("PIN errato");
}

async function upload() {
  for (const f of files.files) {
    const data = await toBase64(f);
    uploaded.push({ name:f.name, type:f.type, data });
  }
  renderFiles();
}

function renderFiles() {
  fileList.innerHTML = uploaded.map((f,i)=>`
    <div>${f.name} <button onclick="delFile(${i})">X</button></div>
  `).join("");
}

function delFile(i){ uploaded.splice(i,1); renderFiles(); }

function save() {
  if(!vid.value) return alert("ID obbligatorio");
  const all = loadAll();
  all[vid.value] = {
    title:title.value,
    desc:desc.value,
    titleSize:titleSize.value,
    titleColor:titleColor.value,
    bgColor:bgColor.value,
    files:uploaded
  };
  saveAll(all);
  alert("Salvato");
  renderList();
}

function renderList(){
  const all = loadAll();
  list.innerHTML = Object.keys(all).map(id=>`
    <div>
      <b>${id}</b> â€”
      <a href="vetrina.html?id=${id}" target="_blank">link</a>
    </div>
  `).join("");
}
</script>

</body>
</html>
