<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>SerCucTech â€¢ Link</title>
<link rel="stylesheet" href="stile.css?v=1">

<style>
  /* mini layout per link */
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  .search{
    width:100%;
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    color:var(--text);
    outline:none;
    margin:10px 0 12px;
  }
  .list{display:flex;flex-direction:column;gap:12px}
  .item{
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    border-radius:16px;
    padding:12px;
    display:flex;
    gap:12px;
    align-items:flex-start;
  }
  .num{
    width:42px;height:42px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    font-weight:900;
    border:1px solid rgba(56,210,122,.35);
    background:rgba(56,210,122,.12);
    color:var(--text);
    flex:0 0 auto;
  }
  .col{flex:1;min-width:0}
  .t{font-weight:900}
  .d{color:var(--muted);margin-top:4px;font-size:13px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btn{
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    color:var(--text);
    border-radius:14px;
    padding:10px 12px;
    font-weight:900;
  }
  .btn.primary{border-color:rgba(56,210,122,.35);background:rgba(56,210,122,.15)}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:var(--muted2);margin-top:8px;word-break:break-all}
</style>
</head>

<body>
  <div class="wrap">
    <div class="topbar-inner" style="border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);border-radius:18px">
      <div class="brandDot"></div>
      <div class="titleWrap">
        <div class="pageTitle" style="font-size:20px">ðŸ”— Indice SerCucTech</div>
        <div class="pageDesc">Vetrine pubbliche + accessi rapidi</div>
      </div>
    </div>

    <input id="q" class="search" placeholder="Cerca: renzo, commercio, abbigliamento, serviziâ€¦">

    <div id="list" class="list"></div>
  </div>

<script>
const $ = s => document.querySelector(s);
const list = $("#list");
const q = $("#q");

let vetrine = [];

function baseUrl(){
  return location.origin + location.pathname.replace(/\/[^\/]*$/, "/");
}

function render(items){
  list.innerHTML = "";
  items.forEach((v, i) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="num">${String(i+1).padStart(2,"0")}</div>
      <div class="col">
        <div class="t">${escapeHtml(v.title || v.id)}</div>
        <div class="d">Apri la vetrina e scorri le foto</div>
        <div class="row">
          <button class="btn primary" data-open>Apri</button>
          <button class="btn" data-copy>Copia link</button>
        </div>
        <div class="mono">${escapeHtml(baseUrl() + "vetrina.html?id=" + encodeURIComponent(v.id))}</div>
      </div>
    `;

    div.querySelector("[data-open]").onclick = () => location.href = `vetrina.html?id=${encodeURIComponent(v.id)}`;
    div.querySelector("[data-copy]").onclick = async () => {
      const link = baseUrl() + `vetrina.html?id=${encodeURIComponent(v.id)}`;
      try{
        await navigator.clipboard.writeText(link);
        alert("âœ… Copiato:\n" + link);
      }catch(e){
        prompt("Copia link:", link);
      }
    };

    list.appendChild(div);
  });
}

function escapeHtml(s){
  return String(s||"").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
  }[m]));
}

async function load(){
  try{
    const r = await fetch("data/vetrine.json", { cache:"no-store" });
    const j = await r.json();
    vetrine = Array.isArray(j) ? j : (j.vetrine || []);
  }catch(e){
    vetrine = [{ id:"renzo11", title:"Bazar di Bostone con SerCucTech" }];
  }
  render(vetrine);
}

q.addEventListener("input", () => {
  const s = q.value.trim().toLowerCase();
  if(!s) return render(vetrine);
  const filtered = vetrine.filter(v =>
    String(v.id||"").toLowerCase().includes(s) ||
    String(v.title||"").toLowerCase().includes(s)
  );
  render(filtered.length ? filtered : vetrine);
});

load();
</script>
</body>
</html>
