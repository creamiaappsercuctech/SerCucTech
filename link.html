<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Indice Link SerCucTech</title>

  <!-- Usa solo lo stile principale -->
  <link rel="stylesheet" href="stile.css?v=4001">

  <style>
    /* Piccoli extra SOLO per questa pagina */
    .wrap{ padding:14px; max-width: 860px; margin: 0 auto; }
    .searchBig{
      width:100%;
      font-size:20px;
      padding:18px 16px;
      border-radius: 18px;
      border: 2px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.22);
      color: var(--text, #eaf0ff);
      outline: none;
      box-shadow: 0 16px 40px rgba(0,0,0,.20);
    }
    .searchBig:focus{ border-color: rgba(56,210,122,.45); }

    .list{ margin-top:14px; display:flex; flex-direction:column; gap:12px; }
    .item{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(15,27,49,.78);
      box-shadow: 0 16px 40px rgba(0,0,0,.22);
      text-decoration:none;
      color: inherit;
    }
    .item:active{ transform: scale(.99); }

    .meta{ min-width:0; }
    .kicker{ opacity:.85; font-size:12px; }
    .title{ font-weight: 950; font-size: 16px; line-height:1.15; margin-top:4px; }
    .small{ opacity:.82; font-size:12px; margin-top:6px; }

    .actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
    .pill{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text, #eaf0ff);
      padding: 12px 14px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 14px;
      cursor:pointer;
    }
    .pill.primary{
      border-color: rgba(56,210,122,.38);
      background: rgba(56,210,122,.14);
    }
    .pill.danger{
      border-color: rgba(255,77,77,.35);
      background: rgba(255,77,77,.12);
    }

    .hint{
      margin-top:12px;
      opacity:.8;
      font-size: 13px;
      line-height:1.35;
    }
    .muted{ opacity:.65; }
    .row{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brandDot" aria-hidden="true"></div>
      <div class="titleWrap">
        <h1 class="pageTitle">üìå Indice Link SerCucTech</h1>
        <p class="pageDesc">Scrivi cosa devi fare e trovi la pagina giusta.</p>
      </div>
      <span class="idBadge" id="verBadge">v?</span>
    </div>
  </header>

  <main class="wrap">
    <input id="q" class="searchBig" placeholder="Scrivi cosa devi fare‚Ä¶ es: numerare oggetti, admin, renzo11" autocomplete="off" />

    <div class="row">
      <button class="pill" id="openAdmin">üîí Admin</button>
      <button class="pill primary" id="openNumerini">üß∑ Inserisci numerini (renzo11)</button>
      <button class="pill" id="openVetrina">üñºÔ∏è Apri vetrina (renzo11)</button>
      <button class="pill danger" id="resetBtn">üßπ Reset cache</button>
    </div>

    <div class="hint">
      ‚úÖ Suggerimento: se scrivi <b>numerare oggetti</b> ti mostro il pulsante per aprire la vetrina gi√† in modalit√† numerini.
      <div class="muted">Se non vedi nulla sotto, vuol dire che <b>vetrine.json</b> non si sta caricando.</div>
    </div>

    <div id="list" class="list" aria-live="polite"></div>
  </main>

<script>
(() => {
  const params = new URLSearchParams(location.search);
  const v = params.get("v") || "4001";
  document.getElementById("verBadge").textContent = "v" + v;

  const q = document.getElementById("q");
  const list = document.getElementById("list");

  // link rapidi (cambiali se vuoi)
  const ID_DEFAULT = "renzo11";
  const adminUrl = "admin-full.html?v=" + v;  // pagina admin consigliata
  const vetrinaUrl = (id) => `vetrina.html?id=${encodeURIComponent(id)}&v=${encodeURIComponent(v)}`;
  const numeriniUrl = (id) => `vetrina.html?id=${encodeURIComponent(id)}&label=1&v=${encodeURIComponent(v)}`;
  const resetUrl = `reset.html?v=${encodeURIComponent(v)}`;

  document.getElementById("openAdmin").onclick = () => location.href = adminUrl;
  document.getElementById("openVetrina").onclick = () => location.href = vetrinaUrl(ID_DEFAULT);
  document.getElementById("openNumerini").onclick = () => location.href = numeriniUrl(ID_DEFAULT);
  document.getElementById("resetBtn").onclick = () => location.href = resetUrl;

  function norm(s){ return (s||"").toLowerCase().trim(); }

  let items = [];

  async function load() {
    list.innerHTML = `<div class="card"><div class="h2">Caricamento‚Ä¶</div><div class="smallHint">Leggo vetrine.json</div></div>`;
    try{
      const r = await fetch("vetrine.json?v=" + encodeURIComponent(v), { cache: "no-store" });
      if(!r.ok) throw new Error("HTTP " + r.status);
      const data = await r.json();
      items = (data && data.vetrine) ? data.vetrine : [];

      render();
    }catch(err){
      list.innerHTML = `
        <div class="card errorCard">
          <div class="h2">Errore: non leggo vetrine.json</div>
          <div class="errorText">${String(err)}</div>
          <div class="smallHint">Controlla che esista: <b>SerCucTech/vetrine.json</b></div>
        </div>
      `;
      console.error(err);
    }
  }

  function render(){
    const needle = norm(q.value);

    // regole ‚Äúintelligenti‚Äù
    const wantsAdmin = needle.includes("admin");
    const wantsNumeri = needle.includes("numer") || needle.includes("oggett") || needle.includes("pin");

    const filtered = items.filter(x => {
      if(!needle) return true;
      const t = norm(x.title);
      const id = norm(x.id);
      return t.includes(needle) || id.includes(needle);
    });

    const blocks = [];

    if(wantsAdmin){
      blocks.push(cardSpecial("üîí Admin", "Apri accesso admin", adminUrl, "Apri"));
    }
    if(wantsNumeri){
      blocks.push(cardSpecial("üß∑ Inserisci numerini", `Apri ${ID_DEFAULT} in modalit√† numerini`, numeriniUrl(ID_DEFAULT), "Apri"));
    }

    for (let i=0; i<filtered.length; i++){
      const it = filtered[i];
      const id = it.id;
      const title = it.title || id;

      const href = vetrinaUrl(id);
      const hrefPins = numeriniUrl(id);

      blocks.push(`
        <a class="item" href="${href}">
          <div class="meta">
            <div class="kicker">id: <b>${escapeHtml(id)}</b> ‚Ä¢ pagina: vetrina.html</div>
            <div class="title">${escapeHtml(title)}</div>
            <div class="small">Tocca la riga per aprire ‚Ä¢ oppure ‚ÄúNumerini‚Äù per entrare gi√† in modalit√† pin</div>
          </div>
          <div class="actions" onclick="event.preventDefault(); event.stopPropagation();">
            <button class="pill" onclick="location.href='${href}'">Apri</button>
            <button class="pill primary" onclick="location.href='${hrefPins}'">Numerini</button>
          </div>
        </a>
      `);
    }

    if(blocks.length === 0){
      list.innerHTML = `<div class="card"><div class="h2">Nessun risultato</div><div class="smallHint">Prova ‚Äúrenzo11‚Äù oppure ‚Äúadmin‚Äù oppure ‚Äúnumerare oggetti‚Äù.</div></div>`;
    } else {
      list.innerHTML = blocks.join("");
    }
  }

  function cardSpecial(title, desc, href, btn){
    return `
      <a class="item" href="${href}">
        <div class="meta">
          <div class="kicker">Scorciatoia</div>
          <div class="title">${escapeHtml(title)}</div>
          <div class="small">${escapeHtml(desc)}</div>
        </div>
        <div class="actions">
          <span class="pill primary">${escapeHtml(btn)}</span>
        </div>
      </a>
    `;
  }

  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  q.addEventListener("input", render);

  // focus automatico
  setTimeout(()=>{ try{ q.focus(); }catch(e){} }, 250);

  load();
})();
</script>
</body>
</html>
