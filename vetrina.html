<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vetrina</title>

<style>
  body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background:#0b1020;
    color:#fff;
    text-align:center;
  }
  header{
    padding:20px;
  }
  #title{
    font-weight:700;
    margin-bottom:10px;
  }
  #desc{
    opacity:.9;
    margin-bottom:20px;
  }
  .gallery{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(120px,1fr));
    gap:10px;
    padding:10px;
  }
  .gallery img{
    width:100%;
    height:120px;
    object-fit:cover;
    border-radius:8px;
    cursor:pointer;
  }

  /* fullscreen image */
  .overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.95);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
  }
  .overlay img{
    max-width:95%;
    max-height:95%;
  }

  .error{
    padding:40px;
    font-size:20px;
  }
</style>
</head>

<body>

<header>
  <div id="title"></div>
  <div id="desc"></div>
</header>

<div class="gallery" id="gallery"></div>

<div class="overlay" id="overlay" onclick="closeFull()">
  <img id="fullImg">
</div>

<script>
/* ================================
   LETTURA ID (FORZATO MINUSCOLO)
================================ */
const params = new URLSearchParams(location.search);
const id = (params.get("id") || "").toLowerCase();

if(!id){
  document.body.innerHTML =
    "<div class='error'>ID vetrina mancante</div>";
  throw new Error("ID mancante");
}

const url = "data/" + id + ".json";

/* ================================
   CARICAMENTO DATI
================================ */
fetch(url)
  .then(r=>{
    if(!r.ok) throw new Error("not found");
    return r.json();
  })
  .then(data=>{
    // controllo ID interno (sicurezza)
    if(data.id && data.id.toLowerCase() !== id){
      throw new Error("id mismatch");
    }
    render(data);
  })
  .catch(()=>{
    document.body.innerHTML = `
      <div class="error">
        <b>Vetrina ${id} non trovata.</b><br><br>
        Pubblica: <code>data/${id}.json</code>
      </div>`;
  });

/* ================================
   RENDER
================================ */
function render(v){
  document.title = v.title || "Vetrina";

  const titleEl = document.getElementById("title");
  const descEl  = document.getElementById("desc");

  titleEl.textContent = v.title || "";
  titleEl.style.fontSize = (v.titleSize || 32) + "px";
  titleEl.style.color = v.titleColor || "#ffffff";

  descEl.textContent = v.desc || "";

  document.body.style.background =
    v.bgColor || "#0b1020";

  const g = document.getElementById("gallery");
  g.innerHTML = "";

  (v.files || []).forEach(f=>{
    if(!f.data) return;
    const img = document.createElement("img");
    img.src = f.data;
    img.onclick = ()=>openFull(f.data);
    g.appendChild(img);
  });
}

/* ================================
   FULLSCREEN IMAGE
================================ */
function openFull(src){
  document.getElementById("fullImg").src = src;
  document.getElementById("overlay").style.display = "flex";
}
function closeFull(){
  document.getElementById("overlay").style.display = "none";
}
</script>

</body>
</html>
