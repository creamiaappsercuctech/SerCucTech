<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Vetrina</title>
  <link rel="stylesheet" href="style.css?v=3">

  <style>
    .waPhotoBtn{
      position:absolute;
      right:10px;
      bottom:10px;
      z-index:50;
      border:none;
      background:#25D366;
      color:#06210f;
      font-weight:1000;
      padding:10px 12px;
      border-radius:14px;
      box-shadow:0 10px 22px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .waPhotoBtn small{font-size:11px;opacity:.9}
    .contactBtn{
      border:1px solid rgba(255,255,255,.25);
      background:rgba(0,0,0,.25);
      color:#fff;
      padding:8px 10px;
      border-radius:12px;
      font-weight:900;
      cursor:pointer;
    }
    .contactBtn.wa{background:rgba(37,211,102,.2)}
  </style>
</head>

<body>
<header class="topbar">
  <div class="topbar-inner">
    <div class="brandDot"></div>
    <div class="titleWrap">
      <h1 id="pageTitle">Caricamentoâ€¦</h1>
      <p id="pageDesc"></p>
    </div>
    <span id="badgeId" class="idBadge">id:-</span>
  </div>

  <!-- VOICE + CONTATTI -->
  <section class="voicePanel" id="voicePanel" hidden>
    <div class="voicePanelInner">
      <div class="voiceTitle">ðŸ“£ Messaggio</div>
      <div id="voiceText" class="voiceText"></div>
      <div id="contactsRow" class="contactsRow"></div>
      <div class="contactsHint">ðŸ‘‰ Tocca per contattare</div>
    </div>
  </section>
</header>

<main class="content">

<section class="card heroCard">
  <div class="hero">
    <button class="navBtn left" id="prevBtn">â€¹</button>

    <div class="mediaStage">
      <div class="imgCounter" id="imgCounter">01/01</div>

      <div class="imgWrap">
        <img id="heroImg" class="heroImg">
        <div id="pinsLayer" class="pinsLayer"></div>
      </div>

      <div class="imgBadge" id="imgBadge">01</div>

      <!-- âœ… WHATSAPP FOTO -->
      <button id="waPhotoBtn" class="waPhotoBtn">
        ðŸŸ¢ WhatsApp Foto<br>
        <small>chiedi info per questo numero</small>
      </button>
    </div>

    <button class="navBtn right" id="nextBtn">â€º</button>
  </div>

  <div id="thumbRow" class="thumbRow"></div>
</section>

<!-- ALTRE VETRINE -->
<section class="card" id="networkCard">
  <h2 class="h2">ðŸ”— Altre vetrine</h2>
  <div id="netList"></div>
</section>

</main>

<!-- SHARE GENERALE -->
<div class="shareDock">
  <button id="shareBtn" class="shareBtn">ðŸŸ¢ WhatsApp Vetrina</button>
</div>

<nav class="bottombar">
  <button id="homeBtn" class="barBtn">Home</button>
  <button id="voiceBtn" class="barBtn">Voice</button>
  <button id="stopBtn" class="barBtn danger">Stop</button>
  <button id="fullBtn" class="barBtn">Full</button>
  <button id="themeBtn" class="barBtn">Tema</button>
  <button id="kioskBtn" class="barBtn">Kiosk</button>
</nav>

<script src="app.js?v=3"></script>

<script>
(async function(){
"use strict";

const qs = new URLSearchParams(location.search);
const ID = qs.get("id") || "renzo11";
document.getElementById("badgeId").textContent = "id: " + ID;

const base = location.origin + location.pathname.replace(/vetrina\.html$/,"");
const linkVetrina = base + "link.html?id=" + ID;

let CONTACTS = [];

// ===== LOAD JSON =====
const res = await fetch("data/"+ID+".json",{cache:"no-store"});
const data = await res.json();

document.getElementById("pageTitle").textContent = data.title || ID;
document.getElementById("pageDesc").textContent = data.description || "";
document.getElementById("voiceText").textContent = data.voice?.text || "";
CONTACTS = Array.isArray(data.contacts) ? data.contacts : [];

if(CONTACTS.length){
  document.getElementById("voicePanel").hidden = false;
}

// ===== RENDER CONTATTI =====
const row = document.getElementById("contactsRow");
row.innerHTML = "";
CONTACTS.forEach(c=>{
  if(!c.phone) return;

  const wa = document.createElement("button");
  wa.className="contactBtn wa";
  wa.textContent = "WhatsApp " + c.name;
  wa.onclick=()=>openWA(c.phone,makeGenericMsg(c.name));

  const call = document.createElement("a");
  call.href="tel:"+c.phone;
  call.className="contactBtn";
  call.textContent="Chiama " + c.name;

  row.appendChild(wa);
  row.appendChild(call);
});

// ===== HELPERS =====
function currentPhoto(){
  const img=document.getElementById("heroImg");
  return img?.currentSrc||img?.src||"";
}
function currentNumber(){
  return document.getElementById("imgBadge")?.textContent||"?";
}
function chooseContact(){
  if(CONTACTS.length===1) return CONTACTS[0];
  const list=CONTACTS.map((c,i)=>`${i+1}) ${c.name}`).join("\n");
  const n=prompt("Invia a:\n"+list);
  const i=parseInt(n)-1;
  return CONTACTS[i]||CONTACTS[0];
}
function openWA(phone,msg){
  const url="https://wa.me/"+phone+"?text="+encodeURIComponent(msg);
  window.open(url,"_blank");
}
function makeGenericMsg(name){
  return `Ciao ${name}! ðŸ‘‹
Ti mando la vetrina:

${linkVetrina}

ðŸ“Œ Dimmi il numero dellâ€™oggetto che ti interessa.`;
}
function makePhotoMsg(name){
  return `Ciao ${name}! ðŸ‘‹
Vorrei informazioni per il numero ${currentNumber()}.

ðŸ”— Vetrina:
${linkVetrina}

ðŸ“· Foto:
${currentPhoto()}`;
}

// ===== SHARE GENERALE =====
document.getElementById("shareBtn").onclick=()=>{
  const c=chooseContact();
  openWA(c.phone,makeGenericMsg(c.name));
};

// ===== WHATSAPP FOTO =====
document.getElementById("waPhotoBtn").onclick=()=>{
  const c=chooseContact();
  openWA(c.phone,makePhotoMsg(c.name));
};

})();
</script>
</body>
</html>
